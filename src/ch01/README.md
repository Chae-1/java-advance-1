프로세스, 스레드
==

## 멀티태스킹, 멀티프로세싱
### 단일 프로그램 실행
- CPU 코어가 하나라고 가정할 때, 한 번에 하나의 프로그램 코드만 실행할 수 있다.
- 하나의 프로그램안에 있는 모든 코드가 실행된 이후, 코드를 실행할 수 있다면 매우 답답할 것이다.
- 이를 해결하기 위해 하나의 CPU 코어로 여러 프로그램을 동시에 실행하는 **멀티태스킹**기술이 등장한다.
### 멀티태스킹
- CPU 코어가 매우 짧은 시간 프로그램 A의 코드를 실행시킨 이후, B의 코드를 실행한다면 두 프로그램이 동시에 실행되는 것처럼 보인다.
- 각 프로그램의 실행 시간을 분할해서 마치 동시에 실행되는 것처럼 동작시키는 기법을 **시분할(Time Sharing)** 기법이라고 한다.
- **컴퓨터 시스템이** **동시에 여러 작업을 수행하는 능력**을 **멀티태스킹**이라고 한다.
### 멀티프로세싱
- **멀티프로세싱**은 CPU 코어가 둘 이상일때는 여러 CPU가 여러 작업을 동시에 처리하는 기법이다.
- 하나의 CPU 코어만을 사용하는 시스템보다 동시에 더 많은 작업을 처리할 수 있다.
### 정리
**멀티프로세싱 vs 멀티태스킹**
- **멀티프로세싱**
    - 여러 CPU를 사용하여 동시에 여러 작업을 수행하는 것을 의미.
    - 멀티태스킹과 다르게 물리적인 CPU 여러 개를 사용해서 동시에 여러 작업을 수행할 수 있다.
- **멀티태스킹**
    - 하나의 CPU를 사용하여 동시에 여러 작업을 수행하는것 처럼 동작하는 방식.
    - 멀티프로세싱과 달리 물리적 CPU가 하나 존재하는 상황을 가정하기에 시분할 방식으로 동작하는 것이지 실제 여러 작업을 동시에 수행하지는 않는다.

CPU 코어를 여러 개 사용하여 동시에 여러 프로그램을 실행하는 기법이 **멀티프로세싱**이고 하나의 CPU 코어가 동시에 여러 프로그램을 실행하는 것 처럼 동작하는 기법이 **멀티태스킹**이다.

여러 개의 CPU를 사용하면서 단일 코어가 여러 작업을 분할해서 수행하면 **멀티프로세싱** 이면서 **멀티태스킹**일 수 있다.

## 프로세스와 스레드

### 프로세스
- 프로그램은 실제 실행하기 전까지는 단순한 파일이다.
- 프로그램을 실행하면 프로세스가 만들어지고 프로그램이 실행된다.
- 운영체제 안에서 **실행중인 프로그램을 프로세스**라 한다.
- 프로세스는 실행 중인 프로그램의 **인스턴스**다.

각 프로세스는 독립적인 메모리 공간을 갖고 있고, 운영체제에서 별도의 작업 단위로 분리해서 관리된다. 별도의 메모리 공간에 존재하기 때문에 서로 간섭하지 않는다. 그래서 프로세스가 다른 프로세스의 메모리에 접근할 수 없다.

#### 프로세스의 메모리 구성
- 코드 섹션
    - 실행할 프로그램의 코드가 저장되는 부분
- 데이터 섹션
    - 전역 변수 및 정적 변수가 저장되는 부분
- 힙 영역
    - 동적으로 할당되는 메모리 영역
- 스택 영역
    - 메서드 호출 시 생성되는 지역 변수, 반환 주소가 저장되는 영역
    - 스레드가 독립적으로 스택 영역을 가지고 있다.

### 스레드
**프로세스는 하나 이상의 스레드를 반드시 포함한다.**
스레드는 프로세스 내에서 실행되는 작업의 단위이다.
한 프로세스 내에서 여러 스레드가 존재할 수 있고, 이 프로세스가 제공하는 동일한 메모리 공간을 공유한다.

**메모리 구성**
- 힙, 코드, 데이터 섹션은 프로세스 안에 있는 모든 스레드가 공유한다.
- 각 스레드는 개별 스택을 갖는다.

스레드는 프로세스 내에서 실행되는 작업의 단위이다. 한 프로세스 내에서 하나의 스레드가 존재할 수 있고, 한 프로세스 내에 여러 스레드가 존재할 수도 있다.

- **단일 스레드**
    - 한 프로세스 내에 하나의 스레드만 존재.
- **멀티 스레드**
    - 한 프로세스 내에 여러 스레드가 존재.

하나의 프로그램도 동시에 여러 작업을 수행하는 것을 요구하는 프로그램이 많기 때문에 멀티스레드가 반드시 필요하다.

**정리**
- 프로세스는 실행 환경, 자원을 제공하는 컨테이너 역할을 스레드는 CPU를 사용해서 코드를 하나하나 실행한다.


### 스레드와 스케쥴링
CPU 코어가 1개이고 프로세스가 2개 있고 프로세스 A의 스레드는 1개, B의 스레드는 2개라고 가정할 때 다음과 같은 그림으로 구성되어 있다.
![[프로세스2개.png]]
어떤 프로세스의 스레드를 우선적으로 실행시킬지 결정하고 CPU에 스레드를 할당해주는 주체를 **스케쥴러**라고한다.

#### 스케쥴링
- 운영체제 내부에 스케쥴링 큐가 존재하고 각각의 스레드는 스케쥴링 큐에서 대기한다.
- 스케쥴링 알고리즘에 따라 스레드에 CPU가 할당되어 동작한다.
- 일정 시간 만큼 스레드가 실행해야하는 코드를 실행시키고 다른 스레드를 실행시키는 작업을 반복한다.
- 멀티 코어를 가지고 있다면 물리적으로 동시에 여러 스레드를 실행시킬 수 있다.


## 컨택스트 스위칭
스케쥴러에 의해 스레드가 실행 중인 상태에서 다른 스레드를 실행시켜야할 때, 그 스레드가 실행하고 있던 코드 위치, 변수 등등 필요한 정보들을 불러들여 메모리에 저장시켜야한다. 이런 과정을 **컨택스트 스위칭**이라고 한다.

컨택스트 스위칭이 일어나기 이전에 실행 중인 값을 메모리에 잠시 저장하고, 이후에 다시 저장한 값을 CPU에 불러온다.

**멀티스레드가 대부분 효율적이지만, 컨택스트 스위칭 과정으로 인해 항상 효율적이지는 않다.**

#### CPU에 따른 스레드의 개수
CPU의 개수와 스레드의 개수를 일치시킨다고 효율적으로 CPU를 사용하는 것이 아닌 **CPU 바운드**, **I/O 바운드 작업**을 진행하느냐에 따라 나뉜다.

#### CPU 바운드 작업
- CPU의 연산 능력을 많이 요구하는 작업
- 계산, 데이터 처리, 알고리즘 실행 등 CPU의 처리 속도가 작업 완료 시간을 결정하는 경우

#### I/O 바운드 작업
- 연산 능력이 아닌 I/O 작업을 많이 요구하는 작업
- 유휴 상태에 있는 경우가 대부분이고 실제 연산을 수행하는 시간은 굉장히 적다. 이럴 경우에는 CPU와 스레드의 개수를 일치시키는 것이 아니라 스레드의 개수를 횔씬 더 많이 주는 것이 대부분이다.
