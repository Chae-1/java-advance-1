생산자, 소비자 문제
==
생산자 소비자 문제는 멀티스레드 프로그래밍에서 자주 등장하는 동시성 문제 중 하나이다.

여러 스레드가 동시에 데이터를 생산하고 소비하는 상황을 다루는 문제이다.

![img.png](img.png)

**기본 개념**
- **생산자(Producer):** 데이터를 생성하는 역할을 한다. 파일에서 데이터를 읽어오거나 네트워크에서 데이터를 받아오는 스레드가 생산자 역할을 할 수 있다. 
- **소비자(Consumer):** 생성된 데이터를 사용하는 역할을 한다. 예를 들어, 데이터를 처리하거나 저장하는 스레드가 소비자 역할을 수행할 수 있다.
- **버퍼(Buffer):** 생산자가 생성한 데이터를 일시적으로 저장하는 공간. 한정된 크기를 갖고 생산자, 소비자가 이 버퍼를 통해 데이터를 주고 받는다.

문제는 다음과 같다.
- **생산자가 너무 빠를 때:** 버퍼가 가득 차서 더 이상 데이터를 넣을 수 없을 때 까지 생산자가 데이터를 생산한다. 결국 생산자는 버퍼가 빌 때까지 기다려야한다.
- **소비자가 너무 빠를 때:** 버퍼가 비어서 더 이상 소비할 데이터가 없을 때까지 소비자가 데이터를 처리한다.

이 문제는 다음 두 용어로 불린다.
- **생산자 소비자 문제:** 생산자 스레드와 소비자 스레드가 특정 자원을 함께 생산하고, 소비하면서 발생한 문제
- **한정된 버퍼 문제:** 중간에 있는 버퍼의 크기가 한정되어 있기 때문에 발생한다.

#### 생산자 우선 실행 시
생산자 스레드가 데이터를 계속 생성하고 소비자가 게속 소비했을 때 다음과 같은 문제가 발생한다.
- 생산자 스레드가 데이터를 계속 생산하다가 큐가 가득 차 더 이상 데이터를 넣을 수 없을 때 데이터의 손실이 일어날 수 있다.
  - 이를 방지 하기 위해 큐가 가득 찼을 때, 생산자 스레드가 빈 공간이 생길 때 까지 대기하는 것으로 데이터 손실을 방지할 수는 있다.
- 이후 소비자 스레드가 실행하면서 생산한 데이터를 소비한다. 이때도 큐가 비는 상황이 발생할 수 있다.
  - 큐가 빌 경우에 소비자 스레드도 마찬가지로 큐에 데이터가 들어오는 것을 주기적으로 확인하고 데이터를 소비할 수 있다.

스레드가 대기를 한다면, 손실되는 데이터가 하나도 없게 설계할 수 있을 것이다.

이것이 생산자 소비자 문제이다.

#### 소비자 우선 실행 시
- 생산된 데이터가 없기 때문에 모든 소비자 스레드가 데이터를 획득하지 못한다.
- 생산자가 데이터를 생산한다.  

**문제점**
- 생산자 스레드 먼저 실행하는 경우 데이터 손실이 일어나고 소비자 스레드는 데이터를 받지 못한다.
- 소비자 스레드 먼저 실행하는 경우 c1, c2, c3는 데이터를 받지 못하고 data3이 버려진다.

